<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="The new, more flexible output system in the Epoch 5.0 series is around the concept of a &lsquo;pipeline&rsquo;. These are designed to allow as much in-code data reduction as possible. A pipeline for outputting particle data lets you go through a series of selection steps so that you output only the particles you&rsquo;re actually interested in."><link rel=alternate hreflang=en-us href=/tutorial/input_deck_pipeline/><meta name=theme-color content="#3f51b5"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/academic.css><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hucf2a1ead28adac6bbe3177e5d4e4a1f0_753_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hucf2a1ead28adac6bbe3177e5d4e4a1f0_753_192x192_fill_lanczos_center_2.png><link rel=canonical href=/tutorial/input_deck_pipeline/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="EPOCH"><meta property="og:url" content="/tutorial/input_deck_pipeline/"><meta property="og:title" content=" | EPOCH"><meta property="og:description" content="The new, more flexible output system in the Epoch 5.0 series is around the concept of a &lsquo;pipeline&rsquo;. These are designed to allow as much in-code data reduction as possible. A pipeline for outputting particle data lets you go through a series of selection steps so that you output only the particles you&rsquo;re actually interested in."><meta property="og:image" content="/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_300x300_fit_lanczos_2.png"><meta property="twitter:image" content="/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_300x300_fit_lanczos_2.png"><meta property="og:locale" content="en-us"><title>| EPOCH</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_0x70_resize_lanczos_2.png alt=EPOCH></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/images/logo_hub4b4d6a0f57638acebb5550a80c8c030_9243_0x70_resize_lanczos_2.png alt=EPOCH></a></div><div class="navbar-collapse main-menu-item collapse justify-content-end" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/license><span>License</span></a></li><li class=nav-item><a class=nav-link href=/publication><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#quickstart><span>Quick Start</span></a></li><li class=nav-item><a class="nav-link active" href=/tutorial/><span>Tutorials</span></a></li><li class=nav-item><a class=nav-link href=/contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-3" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation">
<span><i class="fas fa-bars"></i></span></button>
<input name=q type=search class=form-control placeholder=Search... autocomplete=off></form><nav class="collapse docs-links" id=docs-nav><div class=docs-toc-item><a class=docs-toc-link href=/tutorial/>Overview</a></div><div class=docs-toc-item><a class=docs-toc-link href=/tutorial/acknowledging_epoch/>Content</a><ul class="nav docs-sidenav"><li><a href=/tutorial/acknowledging_epoch/>Acknowledging EPOCH</a></li><li><a href=/tutorial/basic_examples/>Basic examples</a></li><li><a href=/tutorial/binary_files/>Binary files</a></li><li><a href=/tutorial/calculable_particle_properties/>Calculable particle properties</a></li><li><a href=/tutorial/compiler_flags/>Compiler Flags</a></li><li><a href=/tutorial/compiling/>Compiling</a></li><li><a href=/tutorial/deck_example/>Deck example</a></li><li><a href=/tutorial/decktransclusiontest/>DeckTransclusionTest</a></li><li><a href=/tutorial/example_creator/>Example creator</a></li><li><a href=/tutorial/faq/>FAQ</a></li><li><a href=/tutorial/formattingexamples/>FormattingExamples</a></li><li><a href=/tutorial/hrtest/>HRtest</a></li><li><a href=/tutorial/input_deck_adf/>Input deck adf</a></li><li><a href=/tutorial/input_deck_antenna/>Input deck antenna</a></li><li><a href=/tutorial/input_deck_boundaries/>Input deck boundaries</a></li><li><a href=/tutorial/input_deck_collisions/>Input deck collisions</a></li><li><a href=/tutorial/input_deck_constant/>Input deck constant</a></li><li><a href=/tutorial/input_deck_control/>Input deck control</a></li><li><a href=/tutorial/input_deck_dist_fn/>Input deck dist fn</a></li><li><a href=/tutorial/input_deck_field_operator/>Input deck field operator</a></li><li><a href=/tutorial/input_deck_fields/>Input deck fields</a></li><li><a href=/tutorial/input_deck_injector/>Input deck injector</a></li><li><a href=/tutorial/input_deck_laser/>Input deck laser</a></li><li><a href=/tutorial/input_deck/>Input deck</a></li><li><a href=/tutorial/input_deck_operator/>Input deck operator</a></li><li><a href=/tutorial/input_deck_output_block/>Input deck output block</a></li><li><a href=/tutorial/input_deck_output_global/>Input deck output global</a></li><li><a href=/tutorial/input_deck_particle_file/>Input deck particle file</a></li><li class=active><a href=/tutorial/input_deck_pipeline/>Input deck pipeline</a></li><li><a href=/tutorial/input_deck_probe/>Input deck probe</a></li><li><a href=/tutorial/input_deck_qed/>Input deck qed</a></li><li><a href=/tutorial/input_deck_species/>Input deck species</a></li><li><a href=/tutorial/input_deck_subset/>Input deck subset</a></li><li><a href=/tutorial/input_deck_test_page/>Input deck test page</a></li><li><a href=/tutorial/input_deck_window/>Input deck window</a></li><li><a href=/tutorial/landing_page/>Landing Page</a></li><li><a href=/tutorial/libraries/>Libraries</a></li><li><a href=/tutorial/links/>Links</a></li><li><a href=/tutorial/maths_parser/>Maths parser</a></li><li><a href=/tutorial/non-thermal_initial_conditions/>Non-thermal initial conditions</a></li><li><a href=/tutorial/numerical_heating/>Numerical heating</a></li><li><a href=/tutorial/previous_versions/>Previous versions</a></li><li><a href=/tutorial/running/>Running</a></li><li><a href=/tutorial/sidebar/>Sidebar</a></li><li><a href=/tutorial/structure/>Structure</a></li><li><a href=/tutorial/an_example_problem/>An example problem</a></li><li><a href=/tutorial/landing/>Landing</a></li><li><a href=/tutorial/using_delta_f/>Using delta f</a></li><li><a href=/tutorial/using_epoch_in_practice/>Using EPOCH in practice</a></li><li><a href=/tutorial/workshop_examples_continued/>Workshop examples continued</a></li><li><a href=/tutorial/workshop_examples/>Workshop examples</a></li><li><a href=/tutorial/visualising_sdf_files_with_idl_or_gdl/>SDF:Visualising SDF files with IDL or GDL</a></li><li><a href=/tutorial/visualising_sdf_files_with_llnl_visit/>SDF:Visualising SDF files with LLNL VisIt</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=/tutorial/sdf_landing_page/>SDF</a><ul class="nav docs-sidenav"><li><a href=/tutorial/sdf_landing_page/>SDF:Landing Page</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><ul><li><a href=#name>Name</a></li><li><a href=#particle_sources>Particle sources</a></li><li><a href=#particle_operators>Particle operators</a></li><li><a href=#particle_variable_output>Particle variable output</a></li><li><a href=#derived_variables>Derived variables</a></li><li><a href=#field_variables>Field variables</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><article class=article><div class=docs-article-container><h1></h1><div class=article-style><p>The new, more flexible output system in the Epoch 5.0 series is around
the concept of a &lsquo;pipeline&rsquo;. These are designed to allow as much
in-code data reduction as possible. A pipeline for outputting particle
data lets you go through a series of selection steps so that you output
only the particles you&rsquo;re actually interested in. As in the older
system, you can select by species or momentum, make a random selection,
or track only those particles that have left the system. Unlike the
older system, you can also produce much more complex selection operators
such as tracking all those particles that started the simulation in a
particular grid cell. Additionally, distributions functions have been
made much more flexible, adding more axes and allowing you to directly
output e.g. energy as a function of angle.</p><p>Pipelines start with a source of particles (usually the name of a
species or probe), apply a series of operators to select some subset of
these, and then produce a series of outputs, either raw particle data or
derived variables such as number density on a grid. Grid based or
distribution function outputs can be further processed to restrict in
space, average over time, etc.</p><p>Everything that was possible under the old system remains possible, and
decks should continue to work as before. More complex decks may benefit
from rewriting in the new system.</p><h1 id=simple_outputs_in_old_and_new_systems>Simple outputs in old and new systems</h1><p>Before going through the details of the new pipelines, we show a few
examples compared to the old system to illustrate the general structure
and benefits.</p><p>A typical output using the old system is something like this, taken from
the two-stream deck (tests/twostream/input.deck)</p><pre><code class=language-perl>begin:output
   ... # Omitting dumptime specs etc

   # Properties at particle positions
   particles = always
   px = always

   # Properties on grid
   grid = always
   ex = always
   number_density = always + species
end:output
</code></pre><p>We can reproduce this with pipelines</p><pre><code class=language-perl>begin:pipeline
   name = particles # Pipeline name, for use in output block where timings are set
   species : Left, Right # Do sum of Left and Right
   species : Left # Also output Left only
   species : Right # Also output Right only
   particle_variable : dir_px  # Output px
   derived_variable : number_density # Built in number density output
   field_variable : io_ex # Output ex also
end:pipeline
</code></pre><p>Doing more complex selection in the old system used the concept of
subsets, such as</p><pre><code class=language-perl>begin:subset
   name = mysub
   random_fraction = 0.1
   include_species : Left
   include_species : Right
end:subset

begin:output
   ... # Omitting dumptime specs etc

   # Properties on grid
   grid = always
   number_density = always + species + mysub
end:output
</code></pre><p>which now becomes</p><pre><code class=language-perl>begin:pipeline
   name = particles
   species : Left
   species : Right
   particle_operator : random_fraction(0.1)
   derived_variable : number_density # Built in number density output
end:pipeline
</code></pre><h1 id=a_more_complex_output>A more complex output</h1><p>The real power of the pipelines is to shorten and simplify relatively
complex output specs using multiple selectors, which would previously
have required multiple subsets. For instance, if we have multiple
ionisation states, but the high-numbered ones contain very few
particles, so we want to sum their number densities, we would have used
something like</p><pre><code class=language-perl>begin:subset
   name = base
   random_fraction = 0.1
   include_species : Carbon
end:subset
begin:subset
   name = one
   random_fraction = 0.1
   include_species : Carbon1
end:subset
begin:subset
   name = two
   random_fraction = 0.1
   include_species : Carbon2
end:subset
begin:subset
   name = high
   random_fraction = 0.1
   include_species : Carbon3
   include_species : Carbon4
   include_species : Carbon5
end:subset

begin:output
   number_density = always + base + one + two + high + sum
end:output
</code></pre><p>where with pipelines we can specify the species directly, as</p><pre><code class=language-perl>begin:pipeline
   name = particles
   species: Carbon
   species : Carbon1
   species : Carbon2
   species : Carbon3, Carbon4, Carbon5
   particle_operator : random_fraction(0.1)
   derived_variable : number_density
end:pipeline
</code></pre><p>and it&rsquo;s now far easier to add more selection criteria, such as a
momentum lower bound etc.</p><h1 id=block_details>Block details</h1><p>A typical new output pipeline might look something like</p><pre><code class=language-perl>begin:pipeline
   name = pipe1
   species : electron
   species : electron, proton
   ejected_species : electron
   probe : probe1
   particle_operator : restriction_op
   particle_operator : random_fraction(0.01)
   particle_variable : dir_px
   particle_variable : dir_vz
   derived_variable : number_density # Built in number density output
   derived_variable : x_px_df # User specified distribution function specified by name
   field_variable : io_ex
end:pipeline
</code></pre><p>This will create 4 sets of output, for electrons, the sum of electrons
and protons, ejected electrons and for probe1. An unspecified
restriction is applied, and a random fraction of 1% of the particles are
used. Particle x momentum and z velocity are included in the output. It
also outputs the number density for each species, a custom distribution
function (see below) and the ex field.</p><p>The keys are described below. Note that most keys are optional, but:</p><ul><li>Name is a required key</li><li>If you don&rsquo;t specify any [particle,derived,field]_variable keys
nothing will be output</li><li>Operators are applied in the order specified. This should never
change the output, but may have minor effects on memory and time
taken</li></ul><h3 id=name>Name</h3><p>All pipelines must be named using the name key. This is to allow them to
be referred to in output blocks</p><h3 id=particle_sources>Particle sources</h3><p>Particle sources are specified using one of the following keys</p><ul><li>species - Named species or list of species to output. For each new
species key a new output pipeline for just that species is created.
If a comma separated list of species is specified then the output is
calculated summed over that species</li><li>ejected_species - Named species to output. This outputs particle
data for all particles that have left the domain going through any
of the boundaries. Particles that remain in the domain after
interacting with the boundary (such as through thermal or periodic
boundaries) are not considered ejected. Particles that leave due to
the moving window are not considered ejected.</li><li>probe - Named particle probe. All species specified in the probe are
summed over for output</li></ul><p>For all outputs except for field_variable outputs require at lest one
particle source. No output will be generated if no particle sources are
specified</p><h3 id=particle_operators>Particle operators</h3><p>Particle operators are specified with the particle_operator keyword and
may be either the name of a
<a href=/tutorial/input_deck_operator>named operator
block</a> or a constructor function
for a particle operator (such as random_fraction)</p><h3 id=particle_variable_output>Particle variable output</h3><p>You can specify any
<a href=/tutorial/calculable_particle_properties>calculable particle
property</a> known to
EPOCH as a particle output variable. Simply specify the
particle_variable key, followed by the named calculable particle
property</p><h3 id=derived_variables>Derived variables</h3><p>A derived variable is any output that is ultimately derived from a
particle source. This is either a user specified
<a href=/tutorial/input_deck_adf>advanced distribution
function</a>, specified by name, or a
built in named derived variable. All of the built in variables are
defined on the main simulation grid. The build in derived variables are</p><ul><li>number_density - Output particle number density</li><li>temperature - Particle temperature</li><li>ekbar - Particle mean kinetic energy</li><li>mass_density - Mass density</li><li>charge_density - Charge density</li><li>particles_per_cell - Particles per cell diagnostic</li><li>px_bar - Mean x momentum in each cell</li><li>py_bar - Mean y momentum in each cell</li><li>pz_bar - Mean z momentum in each cell</li><li>modp_bar - Mean total momentum in each cell</li><li>vx_bar - Mean x velocity in each cell</li><li>vy_bar - Mean y velocity in each cell</li><li>vz_bar - Mean z velocity in each cell</li><li>modv_bar - Mean total velocity in each cell</li></ul><h3 id=field_variables>Field variables</h3><p>A field variable is any output on a grid that is not derived from a
particle source and are specified by name. The possible names are</p><ul><li>poynting_x - Poynting flux in X</li><li>poynting_y - Poynting flux in Y</li><li>poynting_z - Poynting flux in Z</li><li>io_ex - Ex field</li><li>io_ey - Ey field</li><li>io_ez - Ez field</li><li>io_bx - Bx field</li><li>io_by - By field</li><li>io_bz - Bz field</li><li>io_jx - Jx field</li><li>io_jy - Jy field</li><li>io_jy - Jz field</li></ul></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/tutorial/input_deck_particle_file/ rel=next></a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=/tutorial/input_deck_probe/ rel=prev></a></div></div></div></div><div class=body-footer><p>Last updated on Jan 1, 0001</p><p class=edit-page><a href=https://github.com/gcushen/hugo-academic/edit/master/content/tutorial/Input_deck_pipeline.md><i class="fas fa-pen pr-2"></i>Edit this page</a></p></div></article><footer class=site-footer><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.</p></footer></main></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script><script>const code_highlighting=!0</script><script>const isSiteThemeDark=!1</script><script>const search_config={indexURI:"/index.json",minLength:1,threshold:.3},i18n={no_results:"No results found",placeholder:"Search...",results:"results found"},content_type={post:"Posts",project:"Projects",publication:"Publications",talk:"Talks"}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.6f1005d1a84220e2f466ff3d8e712f31.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div></body></html>